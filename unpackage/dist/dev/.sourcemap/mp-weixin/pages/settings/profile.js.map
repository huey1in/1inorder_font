{"version":3,"file":"profile.js","sources":["pages/settings/profile.uvue","C:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2V0dGluZ3MvcHJvZmlsZS51dnVl"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 头像 -->\r\n\t\t<view class=\"avatar-section\" @click=\"chooseAvatar\">\r\n\t\t\t<view class=\"avatar-wrapper\">\r\n\t\t\t\t<image class=\"avatar\" :src=\"userInfo.avatar || defaultAvatarImage\" mode=\"aspectFill\"></image>\r\n\t\t\t\t<view class=\"avatar-edit\">\r\n\t\t\t\t\t<text class=\"edit-text\">编辑</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<text class=\"avatar-tip\">点击更换头像</text>\r\n\t\t</view>\r\n\r\n\t\t<!-- 表单 -->\r\n\t\t<view class=\"form-section\">\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">昵称</text>\r\n\t\t\t\t<input \r\n\t\t\t\t\tclass=\"input\" \r\n\t\t\t\t\ttype=\"text\" \r\n\t\t\t\t\tv-model=\"form.nickname\" \r\n\t\t\t\t\tplaceholder=\"请输入昵称\"\r\n\t\t\t\t\tplaceholder-class=\"placeholder\"\r\n\t\t\t\t/>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">手机号</text>\r\n\t\t\t\t<input \r\n\t\t\t\t\tclass=\"input\" \r\n\t\t\t\t\ttype=\"number\" \r\n\t\t\t\t\tv-model=\"form.phone\" \r\n\t\t\t\t\tplaceholder=\"请输入手机号\"\r\n\t\t\t\t\tplaceholder-class=\"placeholder\"\r\n\t\t\t\t\tmaxlength=\"11\"\r\n\t\t\t\t/>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<view class=\"submit-btn\" @click=\"handleSubmit\">\r\n\t\t\t<text class=\"submit-text\">保存</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n\timport { BASE_URL } from '@/common/config.uts'\r\n\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tdefaultAvatarImage: '/static/icons/default-avatar.png',\r\n\t\t\t\tuserInfo: {\r\n\t\t\t\t\tavatar: '',\r\n\t\t\t\t\tnickname: '',\r\n\t\t\t\t\tphone: ''\r\n\t\t\t\t},\r\n\t\t\t\tform: {\r\n\t\t\t\t\tnickname: '',\r\n\t\t\t\t\tphone: ''\r\n\t\t\t\t},\r\n\t\t\t\tavatarFile: null as any\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tthis.loadUserInfo()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tloadUserInfo() {\r\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo')\r\n\t\t\t\tif (userInfo) {\r\n\t\t\t\t\tthis.userInfo = userInfo\r\n\t\t\t\t\tthis.form.nickname = userInfo.nickname || ''\r\n\t\t\t\t\tthis.form.phone = userInfo.phone || ''\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 从服务器获取最新信息\r\n\t\t\t\tconst token = uni.getStorageSync('token')\r\n\t\t\t\tif (token) {\r\n\t\t\t\t\tuni.request({\r\n\t\t\t\t\t\turl: `${BASE_URL}/auth/profile`,\r\n\t\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\t\theader: { 'Authorization': `Bearer ${token}` },\r\n\t\t\t\t\t\tsuccess: (res: any) => {\r\n\t\t\t\t\t\t\tif (res.data.success && res.data.data.user) {\r\n\t\t\t\t\t\t\t\tconst user = res.data.data.user\r\n\t\t\t\t\t\t\t\tthis.userInfo = user\r\n\t\t\t\t\t\t\t\tthis.form.nickname = user.nickname || ''\r\n\t\t\t\t\t\t\t\tthis.form.phone = user.phone || ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tchooseAvatar() {\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tconst tempFilePath = res.tempFilePaths[0]\r\n\t\t\t\t\t\tthis.userInfo.avatar = tempFilePath\r\n\t\t\t\t\t\tthis.avatarFile = tempFilePath\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\thandleSubmit() {\r\n\t\t\t\tconst token = uni.getStorageSync('token')\r\n\t\t\t\t\r\n\t\t\t\t// 如果有新头像，先上传头像\r\n\t\t\t\tif (this.avatarFile) {\r\n\t\t\t\t\tuni.showLoading({ title: '上传头像...' })\r\n\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t\turl: `${BASE_URL}/auth/upload-avatar`,\r\n\t\t\t\t\t\tfilePath: this.avatarFile,\r\n\t\t\t\t\t\tname: 'avatar',\r\n\t\t\t\t\t\theader: { 'Authorization': `Bearer ${token}` },\r\n\t\t\t\t\t\tsuccess: (uploadRes: any) => {\r\n\t\t\t\t\t\t\tconst data = JSON.parse(uploadRes.data)\r\n\t\t\t\t\t\t\tif (data.success && data.data.avatar) {\r\n\t\t\t\t\t\t\t\tthis.userInfo.avatar = data.data.avatar\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.updateProfile()\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\tuni.showToast({ title: '头像上传失败', icon: 'none' })\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.updateProfile()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tupdateProfile() {\r\n\t\t\t\tconst token = uni.getStorageSync('token')\r\n\t\t\t\tuni.showLoading({ title: '保存中...' })\r\n\t\t\t\t\r\n\t\t\t\tconst requestData = {\r\n\t\t\t\t\tnickname: this.form.nickname,\r\n\t\t\t\t\tphone: this.form.phone\r\n\t\t\t\t}\r\n\t\t\t\tuni.__f__('log','at pages/settings/profile.uvue:144','Updating profile with data:', requestData)\r\n\t\t\t\t\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: `${BASE_URL}/auth/profile`,\r\n\t\t\t\t\tmethod: 'PUT',\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'Authorization': `Bearer ${token}`,\r\n\t\t\t\t\t\t'Content-Type': 'application/json'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata: requestData,\r\n\t\t\t\t\tsuccess: (res: any) => {\r\n\t\t\t\t\t\tuni.__f__('log','at pages/settings/profile.uvue:155','Profile update response:', res.data)\r\n\t\t\t\t\t\tif (res.data.success) {\r\n\t\t\t\t\t\t\t// 更新本地存储，使用服务器返回的数据\r\n\t\t\t\t\t\t\tconst serverUser = res.data.data.user || {}\r\n\t\t\t\t\t\t\tconst updatedUserInfo = {\r\n\t\t\t\t\t\t\t\t...this.userInfo,\r\n\t\t\t\t\t\t\t\t...serverUser,\r\n\t\t\t\t\t\t\t\tnickname: serverUser.nickname || this.form.nickname,\r\n\t\t\t\t\t\t\t\tphone: serverUser.phone || this.form.phone\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tuni.setStorageSync('userInfo', updatedUserInfo)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tuni.showToast({ title: '保存成功', icon: 'success' })\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\t\t\t}, 1500)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tuni.showToast({ title: res.data.message || '保存失败', icon: 'none' })\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err: any) => {\r\n\t\t\t\t\t\tuni.__f__('error','at pages/settings/profile.uvue:176','Profile update failed:', err)\r\n\t\t\t\t\t\tuni.showToast({ title: '网络错误', icon: 'none' })\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.container {\r\n\t\tmin-height: 100vh;\r\n\t\tbackground-color: #FFF5F8;\r\n\t\tbackground-image: radial-gradient(circle at 10% 20%, rgba(255, 182, 193, 0.4) 0%, transparent 20%),\r\n\t\t\t\t\t\t  radial-gradient(circle at 90% 80%, rgba(255, 218, 224, 0.4) 0%, transparent 20%);\r\n\t\tpadding: 30rpx 24rpx;\r\n\t}\r\n\r\n\t.avatar-section {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tpadding: 40rpx;\r\n\t\tmargin-bottom: 30rpx;\r\n\t}\r\n\r\n\t.avatar-wrapper {\r\n\t\tposition: relative;\r\n\t\twidth: 180rpx;\r\n\t\theight: 180rpx;\r\n\t}\r\n\r\n\t.avatar {\r\n\t\twidth: 180rpx;\r\n\t\theight: 180rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tborder: 6rpx solid rgba(255, 255, 255, 0.8);\r\n\t\tbox-shadow: 0 8rpx 24rpx rgba(255, 105, 180, 0.3);\r\n\t}\r\n\r\n\t.avatar-edit {\r\n\t\tposition: absolute;\r\n\t\tbottom: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\theight: 50rpx;\r\n\t\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\t\tborder-radius: 0 0 90rpx 90rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.edit-text {\r\n\t\tfont-size: 22rpx;\r\n\t\tcolor: #FFFFFF;\r\n\t}\r\n\r\n\t.avatar-tip {\r\n\t\tmargin-top: 20rpx;\r\n\t\tfont-size: 26rpx;\r\n\t\tcolor: #B8A9C9;\r\n\t}\r\n\r\n\t.form-section {\r\n\t\tbackground-color: rgba(255, 255, 255, 0.9);\r\n\t\tborder-radius: 40rpx;\r\n\t\toverflow: hidden;\r\n\t\tbox-shadow: 0 8rpx 24rpx rgba(255, 105, 180, 0.1);\r\n\t\tbackdrop-filter: blur(10px);\r\n\t}\r\n\r\n\t.form-item {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\tpadding: 36rpx 40rpx;\r\n\t\tborder-bottom: 1px solid rgba(255, 228, 236, 0.6);\r\n\t}\r\n\r\n\t.form-item:last-child {\r\n\t\tborder-bottom: none;\r\n\t}\r\n\r\n\t.label {\r\n\t\twidth: 140rpx;\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #5D4E6D;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\r\n\t.input {\r\n\t\tflex: 1;\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #5D4E6D;\r\n\t}\r\n\r\n\t.placeholder {\r\n\t\tcolor: #B8A9C9;\r\n\t}\r\n\r\n\t.submit-btn {\r\n\t\tmargin-top: 60rpx;\r\n\t\tpadding: 32rpx;\r\n\t\tbackground: linear-gradient(135deg, #FFB6C1 0%, #FF69B4 100%);\r\n\t\tborder-radius: 40rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tbox-shadow: 0 8rpx 24rpx rgba(255, 105, 180, 0.3);\r\n\t}\r\n\r\n\t.submit-btn:active {\r\n\t\ttransform: scale(0.98);\r\n\t}\r\n\r\n\t.submit-text {\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #FFFFFF;\r\n\t\tfont-weight: 800;\r\n\t\tletter-spacing: 2px;\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'D:/order/fontend/pages/settings/profile.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","BASE_URL"],"mappings":";;;AA+CC,MAAA,YAAeA,8BAAA;AAAA,EACd,OAAI;AACH,WAAO;AAAA,MACN,oBAAoB;AAAA,MACpB,UAAU,IAAA,cAAA;AAAA,QACT,QAAQ;AAAA,QACR,UAAU;AAAA,QACV,OAAO;AAAA,OACP;AAAA,MACD,MAAM,IAAA,cAAA;AAAA,QACL,UAAU;AAAA,QACV,OAAO;AAAA,OACP;AAAA,MACD,YAAY;AAAA;EAEb;AAAA,EACD,SAAM;AACL,SAAK,aAAY;AAAA,EACjB;AAAA,EACD,SAAS;AAAA,IACR,eAAY;AACX,YAAM,WAAWC,cAAAA,MAAI,eAAe,UAAU;AAC9C,UAAI,UAAU;AACb,aAAK,WAAW;AAChB,aAAK,KAAK,WAAW,SAAS,YAAY;AAC1C,aAAK,KAAK,QAAQ,SAAS,SAAS;AAAA,MACrC;AAGA,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAI,OAAO;AACVA,sBAAAA,MAAI,QAAQ;AAAA,UACX,KAAK,GAAGC,cAAQ,QAAA;AAAA,UAChB,QAAQ;AAAA,UACR,QAAM,IAAA,cAAE,EAAE,iBAAiB,UAAU,KAAK,IAAI;AAAA,UAC9C,SAAS,CAAC,MAAQ,SAAA;AACjB,gBAAI,IAAI,KAAK,WAAW,IAAI,KAAK,KAAK,MAAM;AAC3C,oBAAM,OAAO,IAAI,KAAK,KAAK;AAC3B,mBAAK,WAAW;AAChB,mBAAK,KAAK,WAAW,KAAK,YAAY;AACtC,mBAAK,KAAK,QAAQ,KAAK,SAAS;AAAA,YACjC;AAAA,UACD;AAAA,QACA,CAAA;AAAA,MACF;AAAA,IACA;AAAA,IAED,eAAY;AACXD,0BAAI,YAAY,IAAA,cAAA;AAAA,QACf,OAAO;AAAA,QACP,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,CAAC,QAAG;AACZ,gBAAM,eAAe,IAAI,cAAc,CAAC;AACxC,eAAK,SAAS,SAAS;AACvB,eAAK,aAAa;AAAA,QACnB;AAAA,MACA,CAAA,CAAA;AAAA,IACD;AAAA,IAED,eAAY;AACX,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAGxC,UAAI,KAAK,YAAY;AACpBA,sBAAAA,MAAI,YAAY,EAAE,OAAO,UAAW,CAAA;AACpCA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK,GAAGC,cAAQ,QAAA;AAAA,UAChB,UAAU,KAAK;AAAA,UACf,MAAM;AAAA,UACN,QAAM,IAAA,cAAE,EAAE,iBAAiB,UAAU,KAAK,IAAI;AAAA,UAC9C,SAAS,CAAC,YAAc,SAAA;AACvB,kBAAM,OAAO,IAAK,KAAA,MAAM,UAAU,IAAI;AACtC,gBAAI,KAAK,WAAW,KAAK,KAAK,QAAQ;AACrC,mBAAK,SAAS,SAAS,KAAK,KAAK;AAAA,YAClC;AACA,iBAAK,cAAa;AAAA,UAClB;AAAA,UACD,MAAM,MAAA;AACLD,0BAAG,MAAC,YAAW;AACfA,0BAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAAA,UAChD;AAAA,QACA,CAAA;AAAA,MACA,OAAK;AACN,aAAK,cAAa;AAAA,MACnB;AAAA,IACA;AAAA,IAED,gBAAa;AACZ,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxCA,oBAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AAEnC,YAAM,cAAc,IAAA,cAAA;AAAA,QACnB,UAAU,KAAK,KAAK;AAAA,QACpB,OAAO,KAAK,KAAK;AAAA,MAClB,CAAA;AACAA,oBAAG,MAAC,MAAM,OAAM,sCAAqC,+BAA+B,WAAW;AAE/FA,oBAAAA,MAAI,QAAQ;AAAA,QACX,KAAK,GAAGC,cAAQ,QAAA;AAAA,QAChB,QAAQ;AAAA,QACR,QAAQ,IAAA,cAAA;AAAA,UACP,iBAAiB,UAAU,KAAK;AAAA,UAChC,gBAAgB;AAAA,SAChB;AAAA,QACD,MAAM;AAAA,QACN,SAAS,CAAC,MAAQ,SAAA;AACjBD,wBAAG,MAAC,MAAM,OAAM,sCAAqC,4BAA4B,IAAI,IAAI;AACzF,cAAI,IAAI,KAAK,SAAS;AAErB,kBAAM,aAAa,IAAI,KAAK,KAAK,QAAK,IAAA,cAAG,CAAA,CAAC;AAC1C,kBAAM,kFACF,KAAK,QAAQ,GACb,UAAU,GACb,EAAA,UAAU,WAAW,YAAY,KAAK,KAAK,UAC3C,OAAO,WAAW,SAAS,KAAK,KAAK,MAAI;AAE1CA,0BAAAA,MAAI,eAAe,YAAY,eAAe;AAE9CA,0BAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAChD,uBAAW,MAAA;AACVA,4BAAG,MAAC,aAAY;AAAA,YAChB,GAAE,IAAI;AAAA,UACN,OAAK;AACNA,0BAAAA,MAAI,UAAU,EAAE,OAAO,IAAI,KAAK,WAAW,QAAQ,MAAM,OAAK,CAAG;AAAA,UAClE;AAAA,QACA;AAAA,QACD,MAAM,CAAC,MAAQ,SAAA;AACdA,wBAAG,MAAC,MAAM,SAAQ,sCAAqC,0BAA0B,GAAG;AACpFA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,QAC7C;AAAA,QACD,UAAU,MAAA;AACTA,wBAAG,MAAC,YAAW;AAAA,QAChB;AAAA,MACA,CAAA;AAAA,IACF;AAAA,EACD;CACD;;;;;;;;;;;;;;ACvLD,GAAG,WAAW,eAAe;"}