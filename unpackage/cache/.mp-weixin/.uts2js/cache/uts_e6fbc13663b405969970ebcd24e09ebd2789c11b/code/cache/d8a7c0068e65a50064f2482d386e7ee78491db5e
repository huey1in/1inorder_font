{"code":"import { defineComponent } from \"vue\";\nimport { BASE_URL } from \"@/common/config\";\nexport default defineComponent({\n    data() {\n        return {\n            defaultAvatarImage: '/static/icons/default-avatar.png',\n            userInfo: new UTSJSONObject({\n                avatar: '',\n                nickname: '',\n                phone: ''\n            }),\n            form: new UTSJSONObject({\n                nickname: '',\n                phone: ''\n            }),\n            avatarFile: null\n        };\n    },\n    onLoad() {\n        this.loadUserInfo();\n    },\n    methods: {\n        loadUserInfo() {\n            const userInfo = uni.getStorageSync('userInfo');\n            if (userInfo) {\n                this.userInfo = userInfo;\n                this.form.nickname = userInfo.nickname || '';\n                this.form.phone = userInfo.phone || '';\n            }\n            // 从服务器获取最新信息\n            const token = uni.getStorageSync('token');\n            if (token) {\n                uni.request({\n                    url: `${BASE_URL}/auth/profile`,\n                    method: 'GET',\n                    header: new UTSJSONObject({ 'Authorization': `Bearer ${token}` }),\n                    success: (res = null) => {\n                        if (res.data.success && res.data.data.user) {\n                            const user = res.data.data.user;\n                            this.userInfo = user;\n                            this.form.nickname = user.nickname || '';\n                            this.form.phone = user.phone || '';\n                        }\n                    }\n                });\n            }\n        },\n        chooseAvatar() {\n            uni.chooseImage(new UTSJSONObject({\n                count: 1,\n                sizeType: ['compressed'],\n                sourceType: ['album', 'camera'],\n                success: (res) => {\n                    const tempFilePath = res.tempFilePaths[0];\n                    this.userInfo.avatar = tempFilePath;\n                    this.avatarFile = tempFilePath;\n                }\n            }));\n        },\n        handleSubmit() {\n            const token = uni.getStorageSync('token');\n            // 如果有新头像，先上传头像\n            if (this.avatarFile) {\n                uni.showLoading({ title: '上传头像...' });\n                uni.uploadFile({\n                    url: `${BASE_URL}/auth/upload-avatar`,\n                    filePath: this.avatarFile,\n                    name: 'avatar',\n                    header: new UTSJSONObject({ 'Authorization': `Bearer ${token}` }),\n                    success: (uploadRes = null) => {\n                        const data = UTS.JSON.parse(uploadRes.data);\n                        if (data.success && data.data.avatar) {\n                            this.userInfo.avatar = data.data.avatar;\n                        }\n                        this.updateProfile();\n                    },\n                    fail: () => {\n                        uni.hideLoading();\n                        uni.showToast({ title: '头像上传失败', icon: 'none' });\n                    }\n                });\n            }\n            else {\n                this.updateProfile();\n            }\n        },\n        updateProfile() {\n            const token = uni.getStorageSync('token');\n            uni.showLoading({ title: '保存中...' });\n            const requestData = new UTSJSONObject({\n                nickname: this.form.nickname,\n                phone: this.form.phone\n            });\n            uni.__f__('log', 'at pages/settings/profile.uvue:144', 'Updating profile with data:', requestData);\n            uni.request({\n                url: `${BASE_URL}/auth/profile`,\n                method: 'PUT',\n                header: new UTSJSONObject({\n                    'Authorization': `Bearer ${token}`,\n                    'Content-Type': 'application/json'\n                }),\n                data: requestData,\n                success: (res = null) => {\n                    uni.__f__('log', 'at pages/settings/profile.uvue:155', 'Profile update response:', res.data);\n                    if (res.data.success) {\n                        // 更新本地存储，使用服务器返回的数据\n                        const serverUser = res.data.data.user || new UTSJSONObject({});\n                        const updatedUserInfo = new UTSJSONObject(Object.assign(Object.assign(Object.assign({}, this.userInfo), serverUser), { nickname: serverUser.nickname || this.form.nickname, phone: serverUser.phone || this.form.phone }));\n                        uni.setStorageSync('userInfo', updatedUserInfo);\n                        uni.showToast({ title: '保存成功', icon: 'success' });\n                        setTimeout(() => {\n                            uni.navigateBack();\n                        }, 1500);\n                    }\n                    else {\n                        uni.showToast({ title: res.data.message || '保存失败', icon: 'none' });\n                    }\n                },\n                fail: (err = null) => {\n                    uni.__f__('error', 'at pages/settings/profile.uvue:176', 'Profile update failed:', err);\n                    uni.showToast({ title: '网络错误', icon: 'none' });\n                },\n                complete: () => {\n                    uni.hideLoading();\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=D:/order/fontend/pages/settings/profile.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getStorageSync","uni.request","uni.chooseImage","uni.showLoading","uni.uploadFile","uni.hideLoading","uni.showToast","uni.__f__","uni.setStorageSync","uni.navigateBack"],"map":"{\"version\":3,\"file\":\"profile.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"profile.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
