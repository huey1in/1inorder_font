{"code":"import { defineComponent } from \"vue\";\nimport { BASE_URL } from \"@/common/config\";\nclass CartItem extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    id: { type: Number, optional: false },\n                    product_id: { type: Number, optional: false },\n                    name: { type: String, optional: false },\n                    price: { type: Number, optional: false },\n                    quantity: { type: Number, optional: false },\n                    images: { type: \"Unknown\", optional: false },\n                    selected: { type: Boolean, optional: false }\n                };\n            },\n            name: \"CartItem\"\n        };\n    }\n    constructor(options, metadata = CartItem.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.id = this.__props__.id;\n        this.product_id = this.__props__.product_id;\n        this.name = this.__props__.name;\n        this.price = this.__props__.price;\n        this.quantity = this.__props__.quantity;\n        this.images = this.__props__.images;\n        this.selected = this.__props__.selected;\n        delete this.__props__;\n    }\n}\nexport default defineComponent({\n    data() {\n        return {\n            cartItems: []\n        };\n    },\n    computed: {\n        allSelected() {\n            return this.cartItems.length > 0 && this.cartItems.every((item) => { return item.selected; });\n        },\n        selectedCount() {\n            return this.cartItems.filter((item) => { return item.selected; }).reduce((sum, item) => { return sum + item.quantity; }, 0);\n        },\n        totalAmount() {\n            return this.cartItems\n                .filter((item) => { return item.selected; })\n                .reduce((sum, item) => { return sum + (item.price || 0) * item.quantity; }, 0);\n        }\n    },\n    onShow() {\n        uni.__f__('log', 'at pages/cart/cart.uvue:92', '购物车页面 onShow 触发');\n        this.fetchCart();\n    },\n    onLoad() {\n        uni.__f__('log', 'at pages/cart/cart.uvue:96', '购物车页面 onLoad 触发');\n        this.fetchCart();\n    },\n    methods: {\n        getProductImage(item) {\n            if (item.images && item.images.length > 0) {\n                return item.images[0];\n            }\n            return DEFAULT_FOOD_IMAGE;\n        },\n        fetchCart() {\n            uni.__f__('log', 'at pages/cart/cart.uvue:108', 'fetchCart 开始执行');\n            const token = uni.getStorageSync('token');\n            uni.__f__('log', 'at pages/cart/cart.uvue:110', 'token:', token ? '已获取' : '未获取');\n            if (!token) {\n                uni.__f__('log', 'at pages/cart/cart.uvue:112', '未登录，跳转到登录页');\n                uni.showToast({ title: '请先登录', icon: 'none' });\n                setTimeout(() => {\n                    uni.navigateTo({ url: '/pages/login/login' });\n                }, 1500);\n                return null;\n            }\n            uni.showLoading({ title: '加载中...' });\n            uni.__f__('log', 'at pages/cart/cart.uvue:121', '开始请求购物车接口');\n            uni.request({\n                url: `${BASE_URL}/cart`,\n                method: 'GET',\n                header: new UTSJSONObject({ 'Authorization': `Bearer ${token}` }),\n                success: (res = null) => {\n                    uni.__f__('log', 'at pages/cart/cart.uvue:127', '购物车接口响应:', UTS.JSON.stringify(res.data));\n                    if (res.data.success && res.data.data.cart) {\n                        const items = res.data.data.cart.items || [];\n                        // 映射后端数据到前端结构\n                        this.cartItems = items.map((item = null) => { return (new UTSJSONObject({\n                            id: item.cart_item_id,\n                            product_id: item.product_id,\n                            name: item.name,\n                            price: item.price,\n                            quantity: item.quantity,\n                            images: item.images || [],\n                            selected: true\n                        })); });\n                        uni.__f__('log', 'at pages/cart/cart.uvue:140', '处理后的购物车数据:', UTS.JSON.stringify(this.cartItems));\n                    }\n                },\n                fail: () => {\n                    uni.showToast({ title: '加载失败', icon: 'none' });\n                },\n                complete: () => {\n                    uni.hideLoading();\n                }\n            });\n        },\n        toggleSelect(item) {\n            item.selected = !item.selected;\n        },\n        toggleSelectAll() {\n            const newStatus = !this.allSelected;\n            this.cartItems.forEach((item) => {\n                item.selected = newStatus;\n            });\n        },\n        changeQuantity(item, delta) {\n            const newQty = item.quantity + delta;\n            if (newQty < 1)\n                return null;\n            const token = uni.getStorageSync('token');\n            uni.request({\n                url: `${BASE_URL}/cart/item/${item.id}`,\n                method: 'PATCH',\n                header: new UTSJSONObject({\n                    'Authorization': `Bearer ${token}`,\n                    'Content-Type': 'application/json'\n                }),\n                data: new UTSJSONObject({\n                    quantity: newQty\n                }),\n                success: (res = null) => {\n                    if (res.data.success) {\n                        item.quantity = newQty;\n                    }\n                }\n            });\n        },\n        removeItem(item) {\n            uni.showModal(new UTSJSONObject({\n                title: '确认删除',\n                content: '确定要删除该商品吗？',\n                success: (res) => {\n                    if (res.confirm) {\n                        const token = uni.getStorageSync('token');\n                        uni.request({\n                            url: `${BASE_URL}/cart/item/${item.id}`,\n                            method: 'DELETE',\n                            header: new UTSJSONObject({\n                                'Authorization': `Bearer ${token}`,\n                                'Content-Type': 'application/json'\n                            }),\n                            success: (res = null) => {\n                                if (res.data.success) {\n                                    const index = this.cartItems.indexOf(item);\n                                    if (index > -1) {\n                                        this.cartItems.splice(index, 1);\n                                    }\n                                }\n                            }\n                        });\n                    }\n                }\n            }));\n        },\n        checkout() {\n            const selectedItems = this.cartItems.filter((item) => { return item.selected; });\n            if (selectedItems.length === 0) {\n                uni.showToast({ title: '请选择商品', icon: 'none' });\n                return null;\n            }\n            uni.navigateTo({ url: '/pages/order/create' });\n        },\n        goShopping() {\n            uni.navigateBack();\n        }\n    }\n});\n//# sourceMappingURL=D:/order/fontend/pages/cart/cart.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.__f__","uni.getStorageSync","uni.showToast","uni.navigateTo","uni.showLoading","uni.request","uni.hideLoading","uni.showModal","uni.navigateBack"],"map":"{\"version\":3,\"file\":\"cart.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"cart.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
