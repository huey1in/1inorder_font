{"code":"import { defineComponent } from \"vue\";\nimport { BASE_URL } from \"@/common/config\";\nclass OrderItem extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    id: { type: Number, optional: false },\n                    quantity: { type: Number, optional: false },\n                    price: { type: Number, optional: false },\n                    product_name: { type: String, optional: false },\n                    images: { type: \"Unknown\", optional: false }\n                };\n            },\n            name: \"OrderItem\"\n        };\n    }\n    constructor(options, metadata = OrderItem.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.id = this.__props__.id;\n        this.quantity = this.__props__.quantity;\n        this.price = this.__props__.price;\n        this.product_name = this.__props__.product_name;\n        this.images = this.__props__.images;\n        delete this.__props__;\n    }\n}\nclass Order extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    id: { type: Number, optional: false },\n                    order_number: { type: String, optional: false },\n                    status: { type: String, optional: false },\n                    total_amount: { type: Number, optional: false },\n                    items: { type: \"Unknown\", optional: false }\n                };\n            },\n            name: \"Order\"\n        };\n    }\n    constructor(options, metadata = Order.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.id = this.__props__.id;\n        this.order_number = this.__props__.order_number;\n        this.status = this.__props__.status;\n        this.total_amount = this.__props__.total_amount;\n        this.items = this.__props__.items;\n        delete this.__props__;\n    }\n}\nexport default defineComponent({\n    data() {\n        return {\n            statusTabs: [\n                new UTSJSONObject({ label: '全部', value: '' }),\n                new UTSJSONObject({ label: '已确认', value: 'confirmed' }),\n                new UTSJSONObject({ label: '制作中', value: 'preparing' }),\n                new UTSJSONObject({ label: '待取餐', value: 'ready' }),\n                new UTSJSONObject({ label: '配送中', value: 'delivering' }),\n                new UTSJSONObject({ label: '已完成', value: 'delivered' }),\n                new UTSJSONObject({ label: '已取消', value: 'cancelled' })\n            ],\n            currentStatus: '',\n            orders: [],\n            loading: false,\n            noMore: false,\n            page: 1\n        };\n    },\n    computed: {\n        displayOrders() {\n            if (this.currentStatus === '')\n                return this.orders;\n            if (this.currentStatus === 'pending') {\n                return this.orders.filter((o = null) => { return o.status === 'pending' && o.payment_status !== 'paid'; });\n            }\n            return this.orders.filter((o = null) => { return o.status === this.currentStatus; });\n        }\n    },\n    onShow() {\n        const status = uni.getStorageSync('orderStatus');\n        if (status) {\n            this.currentStatus = status;\n            uni.removeStorageSync('orderStatus');\n            this.page = 1;\n            this.orders = [];\n            this.noMore = false;\n        }\n        this.fetchOrders();\n    },\n    methods: {\n        getProductImage(item = null) {\n            if (item.images && item.images.length > 0) {\n                return item.images[0];\n            }\n            return DEFAULT_FOOD_IMAGE;\n        },\n        fetchOrders() {\n            const token = uni.getStorageSync('token');\n            if (!token) {\n                // 如果未登录，不跳转，显示空状态或提示\n                return null;\n            }\n            this.loading = true;\n            const requestData = new UTSJSONObject({\n                page: this.page,\n                limit: 10\n            });\n            if (this.currentStatus !== '') {\n                requestData.status = this.currentStatus;\n            }\n            uni.request({\n                url: `${BASE_URL}/orders/my`,\n                method: 'GET',\n                header: new UTSJSONObject({ 'Authorization': `Bearer ${token}` }),\n                data: requestData,\n                success: (res = null) => {\n                    if (res.data.success && res.data.data.orders) {\n                        const newOrders = res.data.data.orders;\n                        if (this.page === 1) {\n                            this.orders = newOrders;\n                        }\n                        else {\n                            this.orders = [...this.orders, ...newOrders];\n                        }\n                        this.noMore = newOrders.length < 10;\n                    }\n                },\n                complete: () => {\n                    this.loading = false;\n                }\n            });\n        },\n        switchStatus(status) {\n            this.currentStatus = status;\n            this.page = 1;\n            this.noMore = false;\n            this.orders = [];\n            this.fetchOrders();\n        },\n        loadMore() {\n            if (this.loading || this.noMore)\n                return null;\n            this.page++;\n            this.fetchOrders();\n        },\n        getStatusText(order = null) {\n            const map = {\n                'pending': '待确认',\n                'confirmed': '已确认',\n                'preparing': '制作中',\n                'ready': '待取餐',\n                'delivering': '配送中',\n                'delivered': '已完成',\n                'cancelled': '已取消'\n            };\n            return map[order === null || order === void 0 ? null : order.status] || (order === null || order === void 0 ? null : order.status) || '';\n        },\n        showDelete(order = null) {\n            return (order === null || order === void 0 ? null : order.status) === 'cancelled' || (order === null || order === void 0 ? null : order.status) === 'delivered';\n        },\n        goDetail(id) {\n            uni.navigateTo({ url: `/pages/order/detail?id=${id}` });\n        },\n        cancelOrder(order) {\n            uni.showModal(new UTSJSONObject({\n                title: '取消订单',\n                content: '确定要取消该订单吗？',\n                success: (res) => {\n                    if (res.confirm) {\n                        const token = uni.getStorageSync('token');\n                        uni.request({\n                            url: `${BASE_URL}/orders/${order.id}/cancel`,\n                            method: 'POST',\n                            header: new UTSJSONObject({ 'Authorization': `Bearer ${token}` }),\n                            success: (res = null) => {\n                                if (res.data.success) {\n                                    uni.showToast({ title: '已取消', icon: 'success' });\n                                    this.page = 1;\n                                    this.fetchOrders();\n                                }\n                            }\n                        });\n                    }\n                }\n            }));\n        },\n        payOrder(order) {\n            uni.showToast({ title: '支付功能开发中', icon: 'none' });\n        },\n        reorder(order) {\n            uni.showToast({ title: '已加入购物车', icon: 'success' });\n            uni.switchTab({ url: '/pages/cart/cart' });\n        },\n        deleteOrder(order) {\n            uni.showModal({\n                title: '删除订单',\n                content: '确定删除该订单吗？',\n                success: (res) => {\n                    if (!res.confirm)\n                        return null;\n                    const token = uni.getStorageSync('token');\n                    uni.request({\n                        url: `${BASE_URL}/orders/${order.id}`,\n                        method: 'DELETE',\n                        header: new UTSJSONObject({ 'Authorization': `Bearer ${token}` }),\n                        success: (resp = null) => {\n                            var _a, _b;\n                            if ((_a = resp.data) === null || _a === void 0 ? null : _a.success) {\n                                uni.showToast({ title: '已删除', icon: 'success' });\n                                this.page = 1;\n                                this.orders = [];\n                                this.noMore = false;\n                                this.fetchOrders();\n                            }\n                            else {\n                                uni.showToast({ title: ((_b = resp.data) === null || _b === void 0 ? null : _b.message) || '删除失败', icon: 'none' });\n                            }\n                        },\n                        fail: () => {\n                            uni.showToast({ title: '网络错误', icon: 'none' });\n                        }\n                    });\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=D:/order/fontend/pages/order/list.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getStorageSync","uni.removeStorageSync","uni.request","uni.navigateTo","uni.showModal","uni.showToast","uni.switchTab"],"map":"{\"version\":3,\"file\":\"list.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"list.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
