{"code":"import { defineComponent } from \"vue\";\nimport { BASE_URL } from \"@/common/config\";\nexport default defineComponent({\n    data() {\n        return {\n            productId: 0,\n            defaultFoodImage: DEFAULT_FOOD_IMAGE,\n            product: new UTSJSONObject({\n                id: 0,\n                name: '',\n                description: '',\n                detail: '',\n                price: 0,\n                original_price: 0,\n                images: [],\n                sales_count: 0,\n                stock_quantity: 0,\n                category_name: ''\n            }),\n            cartCount: 0\n        };\n    },\n    onLoad(options = null) {\n        if (options.id) {\n            this.productId = parseInt(options.id);\n            this.fetchProduct();\n            this.fetchCartCount();\n        }\n    },\n    methods: {\n        fetchProduct() {\n            uni.showLoading({ title: '加载中...' });\n            uni.request({\n                url: `${BASE_URL}/products/${this.productId}`,\n                method: 'GET',\n                success: (res = null) => {\n                    if (res.data.success) {\n                        const data = res.data.data;\n                        if (data.product) {\n                            this.product = data.product;\n                        }\n                        else if (data.products && data.products.length > 0) {\n                            // 兼容可能返回数组的情况\n                            this.product = data.products[0];\n                        }\n                        else {\n                            uni.showToast({ title: '商品不存在', icon: 'none' });\n                        }\n                    }\n                    else {\n                        uni.showToast({ title: '商品不存在', icon: 'none' });\n                    }\n                },\n                fail: () => {\n                    uni.showToast({ title: '网络错误', icon: 'none' });\n                },\n                complete: () => {\n                    uni.hideLoading();\n                }\n            });\n        },\n        fetchCartCount() {\n            const token = uni.getStorageSync('token');\n            if (!token)\n                return null;\n            uni.request({\n                url: `${BASE_URL}/cart/count`,\n                method: 'GET',\n                header: new UTSJSONObject({ 'Authorization': `Bearer ${token}` }),\n                success: (res = null) => {\n                    if (res.data.success) {\n                        this.cartCount = res.data.data.count || 0;\n                    }\n                }\n            });\n        },\n        addToCart() {\n            const token = uni.getStorageSync('token');\n            if (!token) {\n                uni.showToast({ title: '请先登录', icon: 'none' });\n                uni.navigateTo({ url: '/pages/login/login' });\n                return null;\n            }\n            uni.request({\n                url: `${BASE_URL}/cart/add`,\n                method: 'POST',\n                header: new UTSJSONObject({\n                    'Authorization': `Bearer ${token}`,\n                    'Content-Type': 'application/json'\n                }),\n                data: new UTSJSONObject({\n                    product_id: this.productId,\n                    quantity: 1\n                }),\n                success: (res = null) => {\n                    if (res.data.success) {\n                        uni.showToast({ title: '已加入购物车', icon: 'success' });\n                        this.fetchCartCount();\n                    }\n                    else {\n                        uni.showToast({ title: res.data.message || '添加失败', icon: 'none' });\n                    }\n                }\n            });\n        },\n        buyNow() {\n            const token = uni.getStorageSync('token');\n            if (!token) {\n                uni.showToast({ title: '请先登录', icon: 'none' });\n                uni.navigateTo({ url: '/pages/login/login' });\n                return null;\n            }\n            // 直接购买逻辑\n            uni.navigateTo({\n                url: `/pages/order/create?product_id=${this.productId}&quantity=1`\n            });\n        },\n        goToHome() {\n            uni.switchTab({ url: '/pages/index/index' });\n        },\n        goToCart() {\n            uni.switchTab({ url: '/pages/cart/cart' });\n        }\n    }\n});\n//# sourceMappingURL=D:/order/fontend/pages/product/detail.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.showLoading","uni.request","uni.showToast","uni.hideLoading","uni.getStorageSync","uni.navigateTo","uni.switchTab"],"map":"{\"version\":3,\"file\":\"detail.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"detail.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
